


<script>
  const fetchCountryData = async ()=>{
    let location = null;
    const response =await fetch("https://appmixo.in/cdn-cgi/trace", {
      method: 'GET',
      redirect: 'follow'
    })
      .then(response => response.text())
      .then(async(result) => {
        location = await (result.split('\n').reduce((obj,ele)=>{
          let arr = ele.split("=");
          return {...obj,[arr[0]]:arr[1]}
          },{}).loc);
      })
      .catch((error) => {
          console.log('error', error)
      });
    if(location)
    {
      return location;
    }else{
      return "location";
    }  
  }
  const CountryCodeFromUrl =async () =>{
      try{

        if(window.location.search)
        {
          document.cookie = `location=${window.location?.search?.split("=")[1]}`
        }else{
          
            const cookie_d = document.cookie.split(";").reduce((obj,ele)=>{
              let arr=ele.split("=");
              return {...obj,[arr[0]]:arr[1]} },{})[" location"];
              if(cookie_d && cookie_d.length<8)
              {
                document.cookie = `location=${cookie_d}`;

              }else{
                const code = await fetchCountryData();
                document.cookie = `location=${code}`;

              }
        } 
        return (document.cookie.split(";").reduce((obj,ele)=>{ let arr=ele.split("=");  return {...obj,[arr[0]]:arr[1]} },{})[" location"]);
      }catch(e) {
          CountryCodeFromUrl();
      }
  }
  const dynamicContent = async ()=>{
          const c_code = await CountryCodeFromUrl();
          const country_content = getContent();
          const  c_data= country_content.find((e)=>{return ((e[0] === c_code))}) 
          let data = null;

          if(c_data){
            data = c_data;
          }else{
            const d_data = country_content.find((e)=>{return ((e[0] === "Default"))}) 
            data = d_data;
          }        
          if(data)
          {
              const h_color = data[1][0] ? data[1][0][2]:"#fff"
              const header = data[1][0] ? data[1][0][1]:""
    
              const f_color = data[1][1] ? data[1][1][2]:"#fff"
              const footer = data[1][1] ? data[1][1][1]:""
              if (document.querySelectorAll(".dynamic_header_Drop")[0]) {
                document.querySelector(".dynamic_header_Drop").innerHTML = `<div style="background-color:${h_color};padding: 1px;">${header}</div>`;
              }else if(document.getElementsByTagName("header")[0]){
                  document.getElementsByTagName("header")[0].insertAdjacentHTML('afterend',`<div style="background-color:${h_color};padding: 1px;">${header}</div>`);
              }
              
              if (document.querySelectorAll(".dynamic_footer_Drop")[0]) {
                document.querySelector(".dynamic_footer_Drop").innerHTML = `<div style="background-color:${f_color};padding: 1px;">${footer}</div>`;
              }else if (document.getElementsByTagName("footer")[0]) {
                document.getElementsByTagName("footer")[0].insertAdjacentHTML('beforebegin',`<div style="background-color:${f_color};padding: 1px;">${footer}</div>`);
              } 
        }
  }
  
  const getContent = () =>{
    let ALL_CONTENT = [];
    let vv =null;
    {% for metafield in shop.metafields.appmixo_dynamic %}
      {% assign variable = 'appmixo_' | append: forloop.index0 %}
      vv= {{ shop.metafields.appmixo_dynamic[ variable ] }} 
      for (const [key, value] of Object.entries(vv)) {
         ALL_CONTENT.push([key,value]);

      }   
    {% endfor %}   
     return ALL_CONTENT ;
  }
  
  document.addEventListener("readystatechange", async() => {

    switch (event.target.readyState) {
      case 'loading':

        break;

      case 'interactive':
        console.log("interactive 0.3.0")
       
        dynamicContent();
        break;

      case 'complete':
        break;
    }
  })
</script>

{% schema %}
{
"name": "Country Wise Content",
"target": "body",
"settings": []
}
{% endschema %}